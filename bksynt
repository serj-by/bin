FROMDIR="/Users/serj/www/locamp/reiki_ru/r/extensions/Synthes"
DB="reiki_ru"
. cdbak
SKIPS="$1"
shift
COMMENTPARAMS="$@"
echo "Skips: $SKIPS"
echo "CommentParams: $COMMENTPARAMS"
PARAMPART="`echo -n $COMMENTPARAMS | tr -c '[[:alnum:]]' '_'`"
if [ "$PARAMPART" == "" ]; then
echo "Params empty. Processing with defults..."
TMDIR="`sbtime short_`"
else
echo "Suffix from param: $PARAMPART"
TMDIR="`sbtime short_`__$PARAMPART"
fi
echo "Creating in-date directory $TMDIR ..."
mkdir $TMDIR
cd $TMDIR
BKDIR=`pwd`
echo "Bak dir: $BKDIR . Copy from $FROMDIR ..."
cp -R $FROMDIR $BKDIR
cd $FROMDIR
if [ "$SKIPS" != "--skipgit" -a "$SKIPS" != "--skip" ]; then
echo "Commit from `pwd` ..."
COMMITMSG="auto commit after backup"
if [ "$@" != "" ]; then
COMMITMSG="$@"
fi
echo "Start commit with msg: $COMMITMSG"
gcm_noint "\"$COMMITMSG\""
echo "Finished commit with msg: $COMMITMSG"
else
echo "Skip git commit due to first argument is '$SKIPS' ..."
fi
if [ "$SKIPS" != "--skipsql" -a "$SKIPS" != "--skip" ]; then
SQLDIR=$BKDIR/_sql
mkdir $SQLDIR
cd $SQLDIR
echo "Start Dumping SQL into `pwd`"
mydump.sh $DB "backup dump"
echo "Start Dumping SISTem SQL into `pwd`"
simydump.sh $DB "backup dump"
echo "Finished dumping SQL"
else
echo "Skip SQL dump due to first argument is '$SKIPS' ..."
fi
echo "Backup complete at `sbdate dashed` @ `sbtime`"
